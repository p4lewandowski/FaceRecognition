
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="pl">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>SystemRozpoznawaniaTwarzy &#8212; SystemIdentyfikacjiOsobNaPodstawieZdjeciaUcha 1.0 - dokumentacja</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Indeks" href="../genindex.html" />
    <link rel="search" title="Szukaj" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Kod źródłowy modułu SystemRozpoznawaniaTwarzy</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="k">import</span> <span class="n">QIcon</span><span class="p">,</span> <span class="n">QPixmap</span><span class="p">,</span> <span class="n">QFont</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QFileDialog</span>

<span class="kn">from</span> <span class="nn">FaceRecognition_gui</span> <span class="k">import</span> <span class="n">Ui_MainWindow</span>
<span class="kn">from</span> <span class="nn">FaceRecognition_eigenfaces_core</span> <span class="k">import</span> <span class="n">FaceRecognitionEigenfaces</span>
<span class="kn">from</span> <span class="nn">FaceRecognition_eigenfaces_recognition</span> <span class="k">import</span> <span class="n">EigenfaceRecognition</span>
<span class="kn">from</span> <span class="nn">FaceRecognition_cnn</span> <span class="k">import</span> <span class="n">Cnn_model</span>
<span class="kn">from</span> <span class="nn">FaceRecognition_plotting</span> <span class="k">import</span> <span class="n">plotReconstructionManual</span><span class="p">,</span> <span class="n">plotTSNE</span><span class="p">,</span> <span class="n">plotPCA2components</span><span class="p">,</span> <span class="n">plotEigenfaces</span><span class="p">,</span> \
    <span class="n">plotPCAcomponents</span><span class="p">,</span> <span class="n">show_found_face</span><span class="p">,</span> <span class="n">create_messagebox</span>
<span class="kn">from</span> <span class="nn">FaceRecognition_cnn_stream</span> <span class="k">import</span> <span class="n">GUI_ConsoleOutput</span>
<span class="kn">from</span> <span class="nn">FaceRecognition_imagepreprocessing</span> <span class="k">import</span> <span class="n">bulk_face_detection</span><span class="p">,</span> <span class="n">bulk_face_visualization</span><span class="p">,</span> <span class="n">bulk_identify_faces</span>

<div class="viewcode-block" id="MainWindow"><a class="viewcode-back" href="../SystemRozpoznawaniaTwarzy.html#SystemRozpoznawaniaTwarzy.MainWindow">[dokumentacja]</a><span class="k">class</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">,</span> <span class="n">Ui_MainWindow</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Szkielet aplikacji. Inicjalizuje GUI a także rozporządza poszczególnymi zaimportowanymi funkcjami.</span>
<span class="sd">    Klasa po wywołaniu inicjalizuje klasy dotyczące obliczeń związanych z sieciami neuronowymi i</span>
<span class="sd">    twarzami własnymi. Dziedziczy GUI i przypisuje przyciskom różne funkcje.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Dziedzicz z QMainWindow i Ui_MainWindow</span>
        <span class="nb">super</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1">################## Zainicjalizuj aplikację ##################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1">################## Zmiany kosmetyczne ##################</span>
        <span class="c1"># Ikony i tytuł okna</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;System rozpoznawania twarzy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowIcon</span><span class="p">(</span><span class="n">QIcon</span><span class="p">(</span><span class="s1">&#39;app_icon.jpg&#39;</span><span class="p">))</span>

        <span class="c1"># Zdjęcia do wizualizacji metod</span>
        <span class="n">pixmap_eigen</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">(</span><span class="s1">&#39;eigenfaces.jpg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">scaledToWidth</span><span class="p">(</span><span class="mi">325</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Eigenfaces_label</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixmap_eigen</span><span class="p">)</span>
        <span class="n">pixmap_neural</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">(</span><span class="s1">&#39;neural_networks_g.jpg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">scaledToHeight</span><span class="p">(</span><span class="mi">320</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Neuralnetworks_label</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixmap_neural</span><span class="p">)</span>
        <span class="c1"># Ustaw domyślne wyświetlanie w Identyfikacje ze zdjęcia</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stackedWidget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1">############### Połącz przyciski ################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LearnEigenfaces</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DatabaseEigenfaces</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddPersonButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addPerson</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifyPerson</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">WelcomeButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turnDatabaseTab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LearnNetworks</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TrainCNN</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">LoadImButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bulk_LoadImage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleViewButton_original</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackedWidget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleViewButton_faces</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackedWidget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleViewButton_identified</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackedWidget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleViewButton_covered</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackedWidget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ShowFacesButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bulk_FindFace</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bulk_IndetifyFaces</span><span class="p">)</span>

        <span class="c1">############### Stwórz klasy do obliczeń ###############</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fr</span> <span class="o">=</span> <span class="n">FaceRecognitionEigenfaces</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnn</span> <span class="o">=</span> <span class="n">Cnn_model</span><span class="p">()</span>
        <span class="c1"># Ustawienie tekstu o ilości dodanych osób</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnn_label_state</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Trenuj model z użyciem </span><span class="si">{}</span><span class="s2"> dodanych osób.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">nb_class</span><span class="p">))</span>
        <span class="n">myFont</span> <span class="o">=</span> <span class="n">QFont</span><span class="p">()</span>
        <span class="n">myFont</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnn_label_state</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">myFont</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<div class="viewcode-block" id="MainWindow.turnDatabaseTab"><a class="viewcode-back" href="../SystemRozpoznawaniaTwarzy.html#SystemRozpoznawaniaTwarzy.MainWindow.turnDatabaseTab">[dokumentacja]</a>    <span class="k">def</span> <span class="nf">turnDatabaseTab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Funkcja inicjalizowana przyciskiem, zmieniająca obecną zakładkę na zakładkę gdzie ładowana</span>
<span class="sd">        jest baza danych dla twarzy własnych i gdzie trenowana jest sieć neuronowa.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabWidget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.identifyPerson"><a class="viewcode-back" href="../SystemRozpoznawaniaTwarzy.html#SystemRozpoznawaniaTwarzy.MainWindow.identifyPerson">[dokumentacja]</a>    <span class="k">def</span> <span class="nf">identifyPerson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Funkcja inicjalizowana przyciskiem, gdzie zależnie od opcji zaznaczonej na przycisku</span>
<span class="sd">        radiowym następuje identyfikacja twarzy z użyciem twarzy własnych bądź z użyciem sieci</span>
<span class="sd">        neuronowej. Funkcja wyświetla również komunikaty zależne od stanu powodzenia funkcji.</span>
<span class="sd">        ID osoby jest pokazywane w oknie komunikatu bądź bezpośrednio na zdjęciu zależnie</span>
<span class="sd">        od użytej metody.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iden_radio_eigen</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">confidence</span><span class="p">,</span> <span class="n">face_id</span><span class="p">,</span> <span class="n">im_searched</span><span class="p">,</span> <span class="n">im_found</span><span class="p">,</span> <span class="n">im_found_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">efr</span><span class="o">.</span><span class="n">recognize_face</span><span class="p">(</span><span class="n">gui</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">confidence</span><span class="p">:</span>
                    <span class="c1"># Jeśli znaleziona twarz nie należy do nowo dodanych tylko do bazy poczatkowej</span>
                    <span class="k">if</span> <span class="n">im_found_id</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">efr</span><span class="o">.</span><span class="n">loaded_im_len</span><span class="p">:</span>
                        <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Twarz została odnaleziona&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;Wyświetlona zostanie osoba w bazie danych.</span><span class="se">\n</span><span class="s2">&quot;</span>
                                          <span class="s2">&quot;Jest to osoba z wczytanej bazy danych.&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># N - liczba zdjęć początkowych w bazie; K - ilość zdjęć wykonywanych dla nowej osoby</span>
                        <span class="c1"># E - indeks znalezionego zdjęcia</span>
                        <span class="c1"># ceil((E-N)/K) - 1 aby indeks zaczynał się od 0</span>
                        <span class="nb">id</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">im_found_id</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">efr</span><span class="o">.</span><span class="n">loaded_im_len</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">efr</span><span class="o">.</span><span class="n">fotosperclass_number</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
                        <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Twarz została odnaleziona&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;Jest to osoba dodana kamerą. ID OSOBY: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
                        <span class="n">show_found_face</span><span class="p">(</span><span class="n">im_searched</span><span class="p">,</span> <span class="n">im_found</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
                        <span class="k">return</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Twarz nie została odnaleziona&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;Dodana twarz nie została zaklasyfikowana.</span><span class="se">\n</span><span class="s2">&quot;</span>
                                      <span class="s2">&quot;Nastąpi wyświetlenie najbardziej zbliżonej osoby.&quot;</span><span class="p">)</span>

                <span class="n">show_found_face</span><span class="p">(</span><span class="n">im_searched</span><span class="p">,</span> <span class="n">im_found</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Brak bazy danych&quot;</span><span class="p">,</span> <span class="s2">&quot;Wczytaj bazę danych.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iden_radio_nn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">nb_class</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">im_searched</span><span class="p">,</span> <span class="n">im_probabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">recognize_face</span><span class="p">(</span><span class="n">gui</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Analiza zakończona&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Nastąpi wyświetlenie wyników.&quot;</span><span class="p">)</span>
                <span class="n">show_found_face</span><span class="p">(</span><span class="n">im_searched</span><span class="p">,</span> <span class="p">[</span><span class="n">im_probabilities</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">img_data</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">label_id</span><span class="p">],</span> <span class="n">cnn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Brak modelu sieci.&quot;</span><span class="p">,</span> <span class="s2">&quot;Dodaj osoby i wytrenuj model.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.addPerson"><a class="viewcode-back" href="../SystemRozpoznawaniaTwarzy.html#SystemRozpoznawaniaTwarzy.MainWindow.addPerson">[dokumentacja]</a>    <span class="k">def</span> <span class="nf">addPerson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Funkcja inicjalizowana przyciskiem, odpowiedzialna za dodanie nowej osoby. Zależnie od</span>
<span class="sd">        przycisku radiowego funkcja albo dodaje osobę do wcześniej wczytanej bazy danych związanej</span>
<span class="sd">        z twarzami własnymi bądź dodaje osobę do zbioru danych związanego z sieciami neuronowymi do</span>
<span class="sd">        przetrenowania sieci w późniejszym czasie. Funkcja wyświetla komunikaty zależne od stanu</span>
<span class="sd">        powodzenia funkcji.</span>
<span class="sd">        Po dodaniu osoby wyświetlone zostanie ID nowo dodanej osoby.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_radio_eigen</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">efr</span><span class="o">.</span><span class="n">add_person</span><span class="p">(</span><span class="n">gui</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PlotEigenfacesData</span><span class="p">()</span>
                <span class="c1"># N - liczba zdjęć początkowych w bazie; K - ilość zdjęć wykonywanych dla nowej osoby</span>
                <span class="c1"># E - liczba wszystkich zdjęć</span>
                <span class="c1"># (E-N)/K - 1 aby indeks zaczynał się od 0</span>
                <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Dodawanie twarzy zakończone&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Baza twarzy została zaktualizowana o nowe dane</span><span class="se">\n</span><span class="s2">ID OSOBY = </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                      <span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efr</span><span class="o">.</span><span class="n">face_data</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">efr</span><span class="o">.</span><span class="n">loaded_im_len</span><span class="p">)</span><span class="o">/</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">efr</span><span class="o">.</span><span class="n">fotosperclass_number</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Brak bazy danych&quot;</span><span class="p">,</span> <span class="s2">&quot;Wczytaj bazę danych.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_radio_nn</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">add_person</span><span class="p">(</span><span class="n">gui</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Dodawanie twarzy zakończone&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Dane do sieci neuronowej zostały dodane.</span><span class="se">\n</span><span class="s2">Trenuj model albo dodaj więcej osób.</span><span class="se">\n</span><span class="s2">&quot;</span>
                              <span class="s2">&quot;ID OSOBY: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">label_id</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cnn_label_state</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Trenuj model z użyciem </span><span class="si">{}</span><span class="s2"> dodanych osób.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">nb_class</span><span class="p">))</span></div>

<div class="viewcode-block" id="MainWindow.DatabaseEigenfaces"><a class="viewcode-back" href="../SystemRozpoznawaniaTwarzy.html#SystemRozpoznawaniaTwarzy.MainWindow.DatabaseEigenfaces">[dokumentacja]</a>    <span class="k">def</span> <span class="nf">DatabaseEigenfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Funkcja wywoływana przyciskiem. Wczytuje ona bazę danych dotyczącą twarzy własnych a</span>
<span class="sd">        następnie wyznacza twarze i wywołuje funkcję do wizualizacji obliczonych danych.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fr</span><span class="o">.</span><span class="n">get_images</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fr</span><span class="o">.</span><span class="n">get_eigenfaces</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">efr</span> <span class="o">=</span> <span class="n">EigenfaceRecognition</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fr</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">PlotEigenfacesData</span><span class="p">()</span>
            <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Baza danych została wczytana&quot;</span><span class="p">,</span> <span class="s2">&quot;Wizualizacja danych dostępna.&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;BŁĄD!&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Brak zdjęć do obliczenia twarzy własnych.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.TrainCNN"><a class="viewcode-back" href="../SystemRozpoznawaniaTwarzy.html#SystemRozpoznawaniaTwarzy.MainWindow.TrainCNN">[dokumentacja]</a>    <span class="k">def</span> <span class="nf">TrainCNN</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Funkcja wywoływana przyciskiem. Gdy więcej niż jedna twarz została dodana do przetrenowania</span>
<span class="sd">        dla sieci neuronowej funkcja inicjalizuje trening sieci a także tworzy nowe okno prezentujące</span>
<span class="sd">        proces treningu sieci. Funkcja wyświetla komunikaty zależne od stanu powodzenia funkcji.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">nb_class</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Niemożliwy trening sieci&quot;</span><span class="p">,</span> <span class="s2">&quot;Baza zawiera za mało osób do treningu.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out_stream</span> <span class="o">=</span> <span class="n">GUI_ConsoleOutput</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">data_processing</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">initialize_networkmodel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">train_cnn</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out_stream</span><span class="o">.</span><span class="n">btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">create_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Sieć przetrenowana.&quot;</span><span class="p">,</span> <span class="s2">&quot;Możliwa identyfikacja osób.&quot;</span><span class="p">)</span>
            <span class="c1"># Odblokuj identyfikację w zdjęciach grupowych</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShowFacesButton</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NetworkTrained</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MainWindow.PlotEigenfacesData"><a class="viewcode-back" href="../SystemRozpoznawaniaTwarzy.html#SystemRozpoznawaniaTwarzy.MainWindow.PlotEigenfacesData">[dokumentacja]</a>    <span class="k">def</span> <span class="nf">PlotEigenfacesData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Funkcja wywoływana automatycznie po wczytaniu bazy dotyczacej twarzy własnych bądź w</span>
<span class="sd">        przypadku dodania nowej osoby do bazy danych.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fr</span><span class="o">.</span><span class="n">stochastic_neighbour_embedding</span><span class="p">()</span>
        <span class="n">plotPCAcomponents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">plotEigenfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">plotPCA2components</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">plotTSNE</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">plotReconstructionManual</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.Bulk_LoadImage"><a class="viewcode-back" href="../SystemRozpoznawaniaTwarzy.html#SystemRozpoznawaniaTwarzy.MainWindow.Bulk_LoadImage">[dokumentacja]</a>    <span class="k">def</span> <span class="nf">Bulk_LoadImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Funkcja wczytująca plik zdjęciowy a następnie wyświetlająca zdjęcie w aplikacji.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="s2">&quot;Images (*.png *.jpg)&quot;</span>
        <span class="n">image_obj</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Open image&#39;</span><span class="p">,</span> <span class="s1">&#39;Desktop&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_obj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bulk_image</span> <span class="o">=</span> <span class="n">bulk_face_visualization</span><span class="p">(</span><span class="n">image_obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleViewButton_original</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ShowFacesButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleViewButton_faces</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleViewButton_identified</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleViewButton_covered</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stackedWidget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="MainWindow.Bulk_FindFace"><a class="viewcode-back" href="../SystemRozpoznawaniaTwarzy.html#SystemRozpoznawaniaTwarzy.MainWindow.Bulk_FindFace">[dokumentacja]</a>    <span class="k">def</span> <span class="nf">Bulk_FindFace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Funkcja zaznaczająca twarze na wcześniej wczytanym zdjęciu.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bulk_face_detection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NetworkTrained</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleViewButton_faces</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stackedWidget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleViewButton_faces</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.Bulk_IndetifyFaces"><a class="viewcode-back" href="../SystemRozpoznawaniaTwarzy.html#SystemRozpoznawaniaTwarzy.MainWindow.Bulk_IndetifyFaces">[dokumentacja]</a>    <span class="k">def</span> <span class="nf">Bulk_IndetifyFaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Funkcja nadpisująca oryginalne twarze wykrytymi twarzami a także wyświetlająca wartości</span>
<span class="sd">        procentowe uzyskane przez sieć neuronową co do poprawności identyfikacji.</span>
<span class="sd">        Funkcja dostepna wyłącznie po przetrenowaniu sieci i dodaniu zdjęcia.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bulk_identify_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">fotosperclass_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleViewButton_identified</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IdentifyPeopleViewButton_covered</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stackedWidget</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">()</span>
    <span class="n">form</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">SystemIdentyfikacjiOsobNaPodstawieZdjeciaUcha</a></h1>








<h3>Nawigacja</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Kod modułu</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Szybkie wyszukiwanie</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Szukaj" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Przemyslaw Lewandowski.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>